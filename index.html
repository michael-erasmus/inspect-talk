<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<meta name="viewport" content="width=1024, user-scalable=no">

	<title>Mixing CoffeeScript with RubyMotion</title>

	<!-- Required stylesheet -->
	<link rel="stylesheet" href="core/deck.core.css">

	<!-- Extension CSS files go here. Remove or add as needed. -->
	<link rel="stylesheet" href="extensions/goto/deck.goto.css">
	<link rel="stylesheet" href="extensions/menu/deck.menu.css">
	<link rel="stylesheet" href="extensions/navigation/deck.navigation.css">
	<link rel="stylesheet" href="extensions/status/deck.status.css">
	<link rel="stylesheet" href="extensions/hash/deck.hash.css">
	<link rel="stylesheet" href="extensions/scale/deck.scale.css">

	<!-- Style theme. More available in /themes/style/ or create your own. -->
	<link rel="stylesheet" href="themes/style/neon.css">
  <link rel="stylesheet" href="themes/style/custom.css">

	<!-- Transition theme. More available in /themes/transition/ or create your own. -->
	<link rel="stylesheet" href="themes/transition/fade.css">

	<!-- Required Modernizr file -->
	<script src="modernizr.custom.js"></script>

  <link rel="stylesheet" href="highlight.js/styles/default.css">
  <script src="highlight.js/highlight.pack.js"></script>
</head>
<body class="deck-container">

<!-- Begin slides. Just make elements with a class of slide. -->
<section class="slide">
</section>
<section class="slide">
  <h1>An apology...</h1>
</section>

<section class="slide centered-text">
  <h2>Muizenberg, Cape Town</h2>
  <img src='images/beach.jpg'></img>
  <img src='images/beach2.jpg'></img>
</section>


<section class="slide">
  <img src='images/board.jpg'></img>
  <h3>Thanks, honey!</h3>
</section>

<section class="slide">
  <img src='images/mimi-surfing.jpg'></img>
</section>

<section class="slide centered-text">
  <h2 class="centered-text">Michael Erasmus</h3>
  <div class="center">
      <img style="float:left;margin-left: 400px;" src='images/twitter.png'></img>
      <h3 style="float:left;margin: 25px 0 0 20px;">@michael_erasmus</h3>
  </div>
  <div class="center" style="clear: both;">
      <img style="float:left;margin-left: 400px;" src="images/github.png">
      <h3 style="float:left;margin: 25px 0 0 20px;">github.com/michael-erasmus</h3>
  </div>

  <div class="center" style="clear: both;">
      <img style="float:left;margin-left: 400px;" src="images/motioncasts.png">
      <h3 style="float:left;margin: 25px 0 0 20px;">motioncasts.tv</h3>
  </div>

  <div class="center" style='clear: both;'>
    <img src='images/book.jpg'></img>
  </div>
</section>

<section class="slide centered-text">
	<h2 class='top-third'>Mixing CoffeeScript with RubyMotion</h2>
</section>

<section class="slide">
	<h1>Uhm...Why?<h1>
</section>

<section class="slide">
	<h1>First, a story...</h1>
</section>

<section class="slide centered-text">
  <h2 class='url-text'>22seven.com</h2>
  <img src='images/22seven1.png'></img>
  <h3 class="slide">Do more with the money you have</h3>
</section>

<section class="slide">
  <h2 class='centered-text'>How?</h2>
  <ol>
    <li class="slide">Collect and aggregate user's financial data</li>
    <li class="slide">Do Awesome Things with it</li>
  </ol>
</section>

<section class="slide centered-text">
  <img src='images/plan.png'></img>
</section>

<section class="slide centered-text">
  <img src='images/inout.png'></img>
</section>

<section class="slide centered-text">
  <img src='images/spending-groups.png'></img>
</section>

<section class="slide centered-text">
  <img src='images/transactions.png'></img>
</section>

<section class="slide centered-text">
  <h2>Early last year:</h2>
  <h3>We did it! We've launched our site!</h3>
  <h3>Let's have some beer!</h3>
  <img src='images/beer.jpg'></img>
</section>

<section class="slide centered-text">
    <h2>Customers:</h2>
    <h2>"Uhm...what about mobile?"</h2>
    <img src='images/cat.png'></img>
</section>

<section class="slide centered-text">
  <img style='margin-top:175px' src='images/wipeout.jpg'></img>
</section>

<section class="slide centered-text">
  <img src='images/iphone.png'></img>
</section>

<section class="slide centered-text">
  <h2>RubyMotion to the rescue!</h2>
  <img src='images/rubymotion.png'></img>
  <h3 class='slide'>But....</h3>
</section>

<section class="slide centered-text">
  <h2>What about...</h2>
  <div class='image-grid'>
    <img src='images/android.jpg'></img>
    <img src='images/html5.png'></img>
    <img src='images/win8.jpg'></img>
  </div>
</section>

<section class="slide centered-text">
  <h2>Martin Fowler already figured it out</h2>
  <img src='images/mf.jpeg'></img>
  <div class='slide'>
    <img src='images/mf-beer.jpg'></img>
  </div>
</section>

<section class="slide centered-text">
  <h2>Developing software for Multiple Mobile Devices</h2>
  <h3 class="url-text">martinfowler.com/articles/multiMobile</h3>
  <img src='images/mf-slide.png'></img>
</section>

<section class="slide">
  <h1>tl;dr</h1>
</section>

<section class="slide centered text">
  <h2>3 ways of building cross-platform apps</h2>
  <img src='images/xplatform2.png'></img>
</section>

<section class="slide centered text">
  <h2>Native on all platforms</h2>
  <ul>
    <li class="slide">Great user experience</li>
    <li class="slide">No restrictions</li>
    <li class="slide">Close to the metal</li>
  </ul>
</section>

<section class="slide centered text">
  <h2>But...</h2>
  <ul>
    <li class="slide">Cost</li>
    <li class="slide">No reuse</li>
  </ul>
</section>

<section class="slide centered text">
  <h2>Cross-platform toolkits</h2>
    <ul>
      <li class="slide">Uhm, works on different platforms</li>
      <li class="slide">Shared code base</li>
      <li class="slide">Standard web technology</li>
    </ul>
  </li>
</section>

<section class="slide centered text">
  <h2>But...</h2>
    <ul>
      <li class="slide">Another layer of indirection</li>
      <li class="slide">Uncanny valley</li>
    </ul>
  </li>
</section>

<section class="slide centered text">
  <img style="margin-top:40px" src='images/uncanny-valley.jpg'></img>
</section>

<section class="slide centered text">
  <img style="margin-top:40px" src='images/rick.jpg'></img>
</section>

<section class="slide centered text">
  <h2>HTML5 mobile apps</h2>
  <ul>
    <li class="slide">Really works everywhere</li>
    <li class="slide">Ease of development, deployment</li>
  </ul>
</section>

<section class="slide centered text">
  <h2>But...</h2>
  <ul>
    <li class="slide">No app store = No trust</li>
    <li class="slide">Non-native UI</li>
    <li class="slide">Device features</li>
  </ul>
</section>

<section class="slide centered-text">
  <h2>Is there another way?</h2>
  <ul>
    <li class="slide">Hybrid apps!</li>
    <li class='slide'>Native + JS</li>
  </ul>
</section>

<section class="slide">
  <div>
    <img class='circle' src='images/circle1.png'></img>
    <img id='js-body0' class='js-body slide' src='images/body.png'></img>
  </div>
  <div>
    <img class='circle' src='images/circle2.png'></img>
    <img id='js-body1' class='js-body slide' src='images/body.png'></img>
 </div>
  <div>
    <img class='circle' src='images/circle3.png'></img>
    <img id='js-body3' class='js-body slide' src='images/body.png'></img>
  </div>
 </section>

<section class='slide centered-text'>
  <h2>What goes into your body?</h2>
  <h3 class="slide">Anything non UI related</h3>
  <h3 class="slide">Resuable domain logic</h3>
  <h3 class="slide">Lots of small composable functions -> higher level functions</h3>
</section>

<section class='slide centered-text'>
  <h2>Sounds easy, right?</h2>
  <h3 class='slide'>Well it's not...</h3>
  <ul>
    <li class='slide'>Building resuable code with no unnecessary duplication is hard</li>
    <li class='slide'>But the benefits are huge</li>
  </ul>
</section>

<section class='slide'>
  <img src='images/big-wave.jpg'></img>
</section>

<section class='slide'>
  <h1>Let's see some code!</h1>
</section>

<section class='slide'>
  <img src='images/choker.jpg'></img>
</section>

<section class='slide'>
  <div class='code language-ruby'>
    <pre class="language-ruby">
      <code>
      class JSController < UIViewController

        def load_web_view
          <div class='highlighted-code'>@web_view = UIWebView.alloc.init</div>
          <div class='highlighted-code'>@web_view.delegate = self</div>


          path = "index.html".resource_url
          file_url = NSURL.fileURLWithPath(path)
          request = NSURLRequest.requestWithURL(file_url)

          @web_view.loadRequest(request)
        end
      end
      </code>
    </pre>
  </div>
</section>


<section class='slide'>
  <div class='code language-ruby'>
    <pre class="language-ruby">
      <code>
      class JSController < UIViewController

        def load_web_view
          @web_view = UIWebView.alloc.init
          @web_view.delegate = self


          <div class='highlighted-code'>path = "index.html".resource_url</div>
          <div class='highlighted-code'>file_url = NSURL.fileURLWithPath(path)</div>
          <div class='highlighted-code'>request = NSURLRequest.requestWithURL(file_url)</div>

          @web_view.loadRequest(request)
        end
      end
      </code>
    </pre>
  </div>
</section>


<section class='slide'>
  <div class='code language-ruby'>
    <pre class="language-ruby">
      <code>
      class JSController < UIViewController

        def load_web_view
          @web_view = UIWebView.alloc.init
          @web_view.delegate = self


          path = "index.html".resource_url
          file_url = NSURL.fileURLWithPath(path)
          request = NSURLRequest.requestWithURL(file_url)

          <div class='highlighted-code'>@web_view.loadRequest(request)</div>
        end
      end
      </code>
    </pre>
  </div>
</section>

<section class='slide'>
  <div class='code language-html'>
    <pre>
      <code>
      &lt;!DOCTYPE html&gt;
      &lt;html lang="en"&gt;
        &lt;head&gt;
          &lt;meta charset="utf-8" / &gt;
          &lt;title&gt;WebView Document&lt;/title&gt;
          &lt;script src='nativeBridge.js'&gt;&lt;/script&gt;
          &lt;script src='jquery.js'&gt;&lt;/script&gt;
          &lt;script src='app.js'&gt;&lt;/script&gt;
        &lt;/head&gt;
        &lt;body&gt;
        &lt;/body&gt;
      &lt;/html&gt;
      </code>
    </pre>
  </div>
</section>

<section class='slide'>
  <div class='code language-html'>
    <pre>
      <code>
      &lt;!DOCTYPE html&gt;
      &lt;html lang="en"&gt;
        &lt;head&gt;
          &lt;meta charset="utf-8" / &gt;
          &lt;title&gt;WebView Document&lt;/title&gt;
          <div class='highlighted-code'>&lt;script src='nativeBridge.js'&gt;&lt;/script&gt;</div>
          &lt;script src='jquery.js'&gt;&lt;/script&gt;
          &lt;script src='app.js'&gt;&lt;/script&gt;
        &lt;/head&gt;
        &lt;body&gt;
        &lt;/body&gt;
      &lt;/html&gt;
      </code>
    </pre>
  </div>
</section>

<section class='slide'>
  <div class='code language-html'>
    <pre>
      <code>
      &lt;!DOCTYPE html&gt;
      &lt;html lang="en"&gt;
        &lt;head&gt;
          &lt;meta charset="utf-8" / &gt;
          &lt;title&gt;WebView Document&lt;/title&gt;
          &lt;script src='nativeBridge.js'&gt;&lt;/script&gt;
          <div class='highlighted-code'>&lt;script src='jquery.js'&gt;&lt;/script&gt;</div>
          <div class='highlighted-code'>&lt;script src='app.js'&gt;&lt;/script&gt;</div>
        &lt;/head&gt;
        &lt;body&gt;
        &lt;/body&gt;
      &lt;/html&gt;
      </code>
    </pre>
  </div>
</section>

<section class='slide'>
  <h2 class='centered-text'>Calling JavaScript</h2>
  <div class='code language-ruby'>
    <pre class="language-ruby">
      <code>
      class JSController < UIViewController
        ###
        def call_js(func)
          js = "#{func}();"
          <div class='highlighted-code'>@web_view.stringByEvaluatingJavaScriptFromString(js)</div>
        end
      end
      </code>
    </pre>
  </div>
</section>

<section class='slide'>
  <h2 class='centered-text'>Calling back into RubyMotion??</h2>
  <div class='code language-ruby'>
    <pre class="language-ruby">
      <code>
      <div class='highlighted-code'>@web_view.addCallBack(...)</div>
      @web_view.stringByEvaluatingJavaScriptFromString(js)
      </code>
    </pre>
  </div>
  <h3 class='slide'>That would be too easy...</h3>
</section>

<section class='slide'>
  <div class='code language-ruby'>
    <pre class="language-ruby">
      <code>
      class JSController < UIViewController

        def call_js_async(func, args, &block)
          <div class='highlighted-code'>@callbacks["#{func}Result"] = &block</div>
          js = "#{func}(#{args});"

          @web_view.stringByEvaluatingJavaScriptFromString(js)
        end

      end
      </code>
    </pre>
  </div>
</section>


<section class='slide'>
  <div class='code language-ruby'>
    <pre class="language-ruby">
      <code>
      js_controller.call_js_async("square", 5) do |n|
        puts "square of 5 is #{n}"
      end
      </code>
    </pre>
  </div>
</section>

<section class='slide'>
  <h2 class='centered-text'>JS function calls back to NativeBridge</h2>
  <div class='code language-coffeescript'>
    <pre>
      <code>
      square = (n) -><div class='highlighted-code'>NativeBridge.call('squareResult', n * n)</div>
      </code>
    </pre>
  </div>
</section>

<section class='slide'>
  <h2 class='centered-text'>NativeBridge 'navigates' to URL, passing in callback + args</h2>
  <div class='code language-coffeescript'>
    <pre class="language-coffeecript">
      <code>
      NativeBridge::call = (callBackId, args) ->
        <div class='highlighted-code'>src = "js-bridge-frame::#{callBackId}::#{args}"</div>
        iframe = document.createElement "IFRAME"
        iframe.setAttribute "src", src
        document.documentElement.appendChild iframe
        iframe.parentNode.removeChild iframe
        iframe = null
      </code>
    </pre>
  </div>
</section>


<section class='slide'>
  <h2 class='centered-text'>NativeBridge 'navigates' to URL, passing in callback + args</h2>
  <div class='code language-coffeescript'>
    <pre class="language-coffeecript">
      <code>
      NativeBridge::call = (callBackId, args) ->
        src = "js-bridge-frame::#{callBackId}::#{args}"
        <div class='highlighted-code'>iframe = document.createElement "IFRAME"</div>
        <div class='highlighted-code'>iframe.setAttribute "src", src</div>
        <div class='highlighted-code'>document.documentElement.appendChild iframe</div>
        iframe.parentNode.removeChild iframe
        iframe = null
      </code>
    </pre>
  </div>
</section>


<section class='slide'>
  <h2 class='centered-text'>Back in the WebView...</h2>
  <div class='code language-ruby'>
    <pre>
      <code>
<div class='highlighted-code'>def webView(view, shouldStartLoadWithRequest:r, navigationType:t)</div>
  request = r.URL.absoluteString

  if(request.hasPrefix("js-bridge-frame"))
    components = request.split("::")
    callback_id, args = components[1], components[2]

    @callbacks[callback_id](args)
    return false
  end
  true
end
      </code>
    </pre>
  </div>
</section>


<section class='slide'>
  <h2 class='centered-text'>Back in the WebView...</h2>
  <div class='code language-ruby'>
    <pre>
      <code>
def webView(view, shouldStartLoadWithRequest:r, navigationType:t)
  request = r.URL.absoluteString

  if(request.hasPrefix("js-bridge-frame"))
    <div class='highlighted-code'>components = request.split("::")</div>
    <div class='highlighted-code'>callback_id, args = components[1], components[2]</div>

    @callbacks[callback_id](args)
    return false
  end
  true
end
      </code>
    </pre>
  </div>
</section>


<section class='slide'>
  <h2 class='centered-text'>Back in the WebView...</h2>
  <div class='code language-ruby'>
    <pre>
      <code>
def webView(view, shouldStartLoadWithRequest:r, navigationType:t)
  request = r.URL.absoluteString

  if(request.hasPrefix("js-bridge-frame"))
    components = request.split("::")
    callback_id, args = components[1], components[2]

    <div class='highlighted-code'>@callbacks[callback_id](args)</div>
    return false
  end
  true
end
      </code>
    </pre>
  </div>
</section>


<section class='slide'>
  <h2 class='centered-text'>Back in the WebView...</h2>
  <div class='code language-ruby'>
    <pre>
      <code>
def webView(view, shouldStartLoadWithRequest:r, navigationType:t)
  request = r.URL.absoluteString

  if(request.hasPrefix("js-bridge-frame"))
    components = request.split("::")
    callback_id, args = components[1], components[2]

    callbacks[callback_id](args)
    <div class='highlighted-code'>return false</div>
  end
  true
end
      </code>
    </pre>
  </div>
</section>

<section class='slide'>
  <h2 class='centered-text'>Phew... can I see a picture?</h2>
  <img src='images/diagram.png'></img>
</section>

<section class='slide'>
  <h2 class='centered-text'>Uhm ok... can I see a movie?</h2>
  <video width="1280" height="800" controls>
  <source src="video/demo.mp4" type="video/mp4">
</section>

<section class='slide'>
  <h2 class='centered-text'>So this works pretty well...but</h2>
  <ul>
    <li class="slide">All data returned ends up as string</li>
    <li class='slide'>The result needs to be URL decoded (this can be slow)</li>
    <li class='slide'>Everything must be async, lots of callbacks</li>
  </ul>
</section>

<section class='slide'>
  <img style="margin-top: 175px;" src='images/surfing.jpg'></img>
</section>

<section class='slide'>
  <h2 class='centered-text'>An example</h2>
  <h3>github.com/michael-erasmus/motion-js</h3>
  <h3>github.com/michael-erasmus/motion-js/tree/master/example</h3>
</section>

<section class='slide'>
  <h2 class='centered-text'>A different approach - JavascriptCore<h2>
  <div class="slide centered-text">
    <img src='images/ejecta.png'></img>
    <h3>impactjs.com/ejecta</h3>
  </div>
  <h3 class="slide">Unchartered territory</h3>
</section>
<section class='slide'>
  <h2 class='centered-text'>An experiment</h2>
  <h3>github.com/michael-erasmus/motion-jsc</h3>
</section>

<section class='slide'>
  <h2>Why CoffeeScript?</h2>
  <img src='images/coffeescript.jpg'></img>
</section>

<section class='slide'>
  <h3>Shorter, more concise, beautiful code</h3>
  <img src='images/cs-vs-js.png'></img>
  <h3 class="slide">Feels more like Ruby</h3>
</section>

<section class='slide'>
  <h2>Real classes</h2>
  <div class='code language-coffeescript'>
    <pre>
      <code>
    class Animal
      constructor: (@name) ->

      move: (meters) ->
        alert @name + " moved #{meters}m."

    class Snake extends Animal
      move: ->
        alert "Slithering..."
        super 5

    class Horse extends Animal
      move: ->
        alert "Galloping..."
        super 45

    sam = new Snake "Sammy the Python"
    tom = new Horse "Tommy the Palomino"

    sam.move()
    tom.move()
      </code>
    </pre>
  </div>
</section>

<section class='slide'>
<!-- => helps with lots of async code, functional style of programming -->
  <h2>=> Fat arrow is awesome</h2>
  <img src='images/fat-arrow.png'></img>
</section>

<section class='slide'>
  <h1>CoffeeScript makes me happy, ok?</h1>
</section>

<section class='slide'>
  <img src='images/surfing-in-hawaii.jpg'></img>
</section>

<section class='slide'>
  <img src='images/teahupoo.jpg'></img>
</section>

<section class='slide centered-text'>
  <h2>Thanks!</h2>
  <h3>github.com/michael-erasmus/inspect-talk</h3>
</section>

<!-- End slides. -->

<!-- Begin extension snippets. Add or remove as needed. -->

<!-- deck.navigation snippet -->
<a href="#" class="deck-prev-link" title="Previous">&#8592;</a>
<a href="#" class="deck-next-link" title="Next">&#8594;</a>

<!-- deck.status snippet -->
<p class="deck-status">
	<span class="deck-status-current"></span>
	/
	<span class="deck-status-total"></span>
</p>

<!-- deck.goto snippet -->
<form action="." method="get" class="goto-form">
	<label for="goto-slide">Go to slide:</label>
	<input type="text" name="slidenum" id="goto-slide" list="goto-datalist">
	<datalist id="goto-datalist"></datalist>
	<input type="submit" value="Go">
</form>

<!-- deck.hash snippet -->
<a href="." title="Permalink to this slide" class="deck-permalink">#</a>

<!-- End extension snippets. -->


<!-- Required JS files. -->
<script src="jquery-1.7.2.min.js"></script>
<script src="core/deck.core.js"></script>

<!-- Extension JS files. Add or remove as needed. -->
<script src="core/deck.core.js"></script>
<script src="extensions/hash/deck.hash.js"></script>
<script src="extensions/menu/deck.menu.js"></script>
<script src="extensions/goto/deck.goto.js"></script>
<script src="extensions/status/deck.status.js"></script>
<script src="extensions/navigation/deck.navigation.js"></script>
<script src="extensions/scale/deck.scale.js"></script>

<!-- Initialize the deck. -->
<script>
	$(function() {
		$.deck('.slide');
	});
</script>

<!-- Initialize the script.js. -->
  <script>
    $(document).ready(function() {
      $('.code').each(function(i, e) {hljs.highlightBlock(e)});
      });
  </script>
</body>
</html>
